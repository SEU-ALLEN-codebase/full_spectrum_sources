# sd_matrix
## Description
Whole-brain quantification of neuronal diversity and stereotypy based on cross-scale features.

## Usage
### Feature Generation of Morphometry at Various Scales[`./src`]
We aim to obtain cross-scale morphometry features for the gold standards (SEU-A1886, manually annotated single neuron morphologies) by merging features from five morphometry levels, which include microenvironment, full morphology, motif, bouton, and arbors. Each of these features is calculated and stored in separate analysis folders.

- **Microenvironment**: These features are estimated using the file "../../microenviron/data/gold_standard_me.csv," generated by the script "../../microenviron/analyses/predict_types.py."

- **Full Morphology**: Features are extracted from "../../full_morpho/data/feature.txt" using the script "../../full_morpho/analyses/sdmatrix.py."

- **Arbor**: Features are stored in "../../arbors/data_examples/features_r2_somaTypes_{apical/basal/axonal}.csv," generated by the script "../../arbors/analyses/arbor_analyzer_r2.py."

- **Motif**: Features are collected in "../../motif/data/motif_features.csv" through the script "../../motif/analyses/sdmatrix.py."

- **Bouton**: These features are derived from the concatenation of the feature files for all neurons, available in "../../bouton/data/bouton_features.csv." The concatenation process is conducted using the script "../../bouton/analyses/bouton_analyzer.py."

### Quantification of Diversity and Stereotypy.
1. **Diversity and Stereotypy Based on Cross-scale Morphological Features**: We generate multiscale features by standardizing and consolidating features from different scales. Subsequently, a pairwise correlation plot between brain regions is created based on these multiscale features. To conduct this analysis, run the `ds_matrix_condense.py` script found in the `./src` folder. The required inputs are the neuronal-level and regional-level similarity matrices for each morphological scale, generated using the `sd_matrix.py` script under the corresponding directory.

2. **Relationship Between Neuron Distances and Similarities**: We investigate the relationship between neuron distances (soma-to-soma and axon-to-axon) and neuron similarities. The axon-to-axon "distance" is determined by calculating the cosine distance between their axonal projections. Neuron similarity between two neurons is computed as the Pearson correlation between their multiscale features. The script `src/distance_vs_correlation.py` is used for this analysis, and the required input includes:
    - Soma positions for all features: `../../common_lib/misc/soma_pos_1886_v20231211_25um.csv`
    - Correlations between neurons: `../multi-scale/corr_neuronLevel_sdmatrix_heatmap_stype_all.csv`. The is the intermediate file generated by `ds_matrix_condense.py` in the same directory.
    - Projection file: `../../common_lib/41586_2021_3941_MOESM4_ESM_proj.csv`
    - Meta-information for the neurons: `../../common_lib/41586_2021_3941_MOESM4_ESM.csv`

3. **Analysis of Cross-Level/Scale Similarity Matrix and Ridge Plots for Intra-Regional Stereotypy**: To explore cross-level/scale similarity matrix and intra-regional stereotypy, run the script `multi-levels_analyzer.py` located in the "./src" folder.
